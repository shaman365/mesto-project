(()=>{"use strict";var e=document.querySelector(".profile__edit-button"),t=document.querySelector(".popup__profile-close-button"),n=document.querySelector(".place__add-button"),r=document.querySelector(".popup__place-close-button"),o=document.querySelector(".popup__picture-close-button"),c=document.querySelector(".profile__avatar-container"),i=document.querySelector(".popup__avatar-close-button"),u=document.forms.form_profile,a=document.forms.form_place,s=document.forms.form_avatar,l=document.querySelector(".popup__input_name"),d=document.querySelector(".popup__input_description"),p=document.querySelector(".popup__input_avatar"),f=document.querySelector(".popup__input_place"),m=document.querySelector(".popup__input_link"),_=document.querySelector(".profile__name"),v=document.querySelector(".profile__description"),y=document.querySelector(".profile__avatar"),h=document.querySelector(".profile__info"),b=document.querySelector(".popup__picture-img"),S=document.querySelector(".popup__picture-caption"),g=document.querySelector(".popup_place"),k=document.querySelector(".popup_picture"),q=document.querySelector(".popup_profile"),L=document.querySelector(".popup_avatar"),C=function(e){e.key&&"escape"===e.key.toLowerCase()&&j(document.querySelector(".popup_opened"))},E=function(e){e.target===e.currentTarget&&j(e.currentTarget)},x=function(e){e.classList.add("popup_opened"),document.addEventListener("keydown",C),e.addEventListener("click",E)},j=function(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",C),e.removeEventListener("click",E)},A={baseUrl:"https://mesto.nomoreparties.co/v1/plus-cohort-24",headers:{authorization:"ed711b57-be95-4829-8ba4-6b07c1de44be","Content-Type":"application/json"}},P=function(e){var t=e.avatar?"/users/me/avatar":"/users/me";return new Promise((function(n,r){fetch(A.baseUrl.concat(t),{method:"PATCH",body:JSON.stringify(e),headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){n(e)})).catch((function(e){console.error("updateUserInfo err:",e),r(e)}))}))},w=document.querySelector(".card").content,O=document.querySelector(".element-grid__list"),U=function(e){var t=w.querySelector(".element-grid__element").cloneNode(!0),n=t.querySelector(".element-grid__image"),r=t.querySelector(".element-grid__caption"),o=t.querySelector(".element-grid__like-button"),c=t.querySelector(".element-grid__delete-button"),i=t.querySelector(".element-grid__like-number");return e.likes.length&&e.likes.some((function(e){return e._id===h.id}))&&o.classList.add("element-grid__like-button_liked"),o.addEventListener("click",(function(e){var t,n=e.target.closest(".element-grid__element").id;e.target.classList.contains("element-grid__like-button_liked")?(t=n,new Promise((function(e,n){fetch(A.baseUrl.concat("/cards/likes/").concat(t),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e(t)})).catch((function(e){console.error("removeLike err:",e),n(e)}))}))).then((function(t){e.target.classList.toggle("element-grid__like-button_liked"),i.textContent=t.likes.length})):function(e){return new Promise((function(t,n){fetch(A.baseUrl.concat("/cards/likes/").concat(e),{method:"PUT",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){console.error("setLike err:",e),n(e)}))}))}(n).then((function(t){e.target.classList.toggle("element-grid__like-button_liked"),i.textContent=t.likes.length}))})),e.owner._id===h.id?c.addEventListener("click",(function(e){var t,n=e.target.closest(".element-grid__element").id;(t=n,new Promise((function(e,n){fetch(A.baseUrl.concat("/cards/").concat(t),{method:"DELETE",headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e(t)})).catch((function(e){console.error("postCard err:",e),n(e)}))}))).then((function(t){e.target.closest(".element-grid__element").remove()}))})):c.style.display="none",n.addEventListener("click",(function(t){b.setAttribute("src",e.link),b.setAttribute("alt",e.name),S.textContent=e.name,x(k)})),n.setAttribute("src",e.link),n.setAttribute("alt",e.name),r.textContent=e.name,i.textContent=e.likes.length,t.id=e._id,t};var T=function(e,t,n,r){!function(e,t){return Array.from(e.querySelectorAll(t)).some((function(e){return!e.validity.valid}))}(e,n)?(t.classList.remove(r),t.removeAttribute("disabled")):(t.classList.add(r),t.setAttribute("disabled",!0))};e.addEventListener("click",(function(){l.value=_.textContent,d.value=v.textContent;var e=q.querySelectorAll(".popup__input");Array.from(e).forEach((function(e){e.classList.remove("popup__input_error"),e.classList.remove("form__input_type_error")}));var t=q.querySelectorAll(".form__input-error");Array.from(t).forEach((function(e){e.textContent="",e.classList.remove("form__input-error_active")})),x(q)})),t.addEventListener("click",(function(){j(q)})),r.addEventListener("click",(function(){j(g)})),o.addEventListener("click",(function(){j(k)})),n.addEventListener("click",(function(){x(g)})),c.addEventListener("click",(function(){x(L)})),i.addEventListener("click",(function(){j(L)})),window.addEventListener("load",(function(){M()})),u.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".popup__save-button");t.textContent="Сохранение...";var n={};n.name=l.value,n.about=d.value,P(n).then((function(e){_.textContent=e.name,v.textContent=e.about,t.textContent="Сохранить"})),j(q)})),a.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".popup__save-button");t.textContent="Сохранение...";var n={};n.name=f.value,n.link=m.value,function(e){return new Promise((function(t,n){fetch(A.baseUrl.concat("/cards"),{method:"POST",body:JSON.stringify(e),headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t(e)})).catch((function(e){console.error("postCard err:",e),n(e)}))}))}(n).then((function(e){O.prepend(U(e))})).catch((function(e){})).finally((function(n){t.classList.add("popup__save-button_disabled"),t.setAttribute("disabled",!0),t.textContent="Сохранить",e.target.reset(),j(g)}))})),s.addEventListener("submit",(function(e){e.preventDefault();var t=e.target.querySelector(".popup__save-button");t.textContent="Сохранение...";var n={};n.avatar=p.value,P(n).then((function(e){y.src=e.avatar})).finally((function(n){t.classList.add("popup__save-button_disabled"),t.setAttribute("disabled",!0),t.textContent="Сохранить",e.target.reset(),j(L)}))}));var D,B,I,M=function(){new Promise((function(e,t){fetch(A.baseUrl.concat("/users/me"),{headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e(t)})).catch((function(e){console.error("getUserInfo err:",e),t(e)}))})).then((function(e){_.textContent=e.name,v.textContent=e.about,y.src=e.avatar,h.id=e._id,new Promise((function(e,t){fetch(A.baseUrl.concat("/cards"),{headers:A.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e(t)})).catch((function(e){console.error("getInitialCards err:",e),t(e)}))})).then((function(e){e.forEach((function(e){O.append(U(e))}))}))}))};B=(D={formSelector:".popup__fieldset",inputSelector:".popup__input",submitButtonSelector:".form__submit",inactiveButtonClass:"popup__save-button_disabled",inputErrorClass:"popup__input_error",errorClass:"form__input-error_active"}).formSelector,I=function(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},c=Object.keys(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(r=0;r<c.length;r++)n=c[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}(D,["formSelector"]),Array.from(document.querySelectorAll(B)).forEach((function(e){!function(e,t){var n=t.inputSelector,r=t.submitButtonSelector,o=t.inactiveButtonClass,c=t.inputErrorClass,i=t.errorClass,u=Array.from(e.querySelectorAll(n)),a=e.querySelector(r);T(e,a,n,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n,r){if(t){var o=e.querySelector(".".concat(t.id,"-input-error"));t.classList.remove(n),o&&(o.classList.remove(r),o.textContent="")}}(e,t,n,r):function(e,t,n,r,o){if(t){t.classList.add(r);var c=e.querySelector(".".concat(t.id,"-input-error"));c&&(c.classList.add(o),c.textContent=n)}}(e,t,t.validationMessage,n,r)}(e,t,c,i),T(e,a,n,o)}))}))}(e,I)}))})();